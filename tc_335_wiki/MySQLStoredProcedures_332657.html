<!DOCTYPE html>
<html>
    <head>
        <title>TrinityCore : MySQLStoredProcedures</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">TrinityCore</a></span>
                            </li>
                                                    <li>
                                <span><a href="TrinityCore-Home_330427.html">TrinityCore Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="How-to_1703987.html">How-to</a></span>
                            </li>
                                                    <li>
                                <span><a href="Advanced_332236.html">Advanced</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            TrinityCore : MySQLStoredProcedures
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
    
            Created by <span class='author'> kingpin</span>, last modified by <span class='editor'> aokromes</span> on Jul 19, 2014
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="MySQLStoredProcedures-WhatisaMySQLStoredProcedure">What is a MySQL Stored Procedure</h1><div class="panel" style="border-width: 1px;"><div class="panelContent">
<p><strong>A procedure in MySQL is a*set of queries</strong> that will be run once procedures is called.</p>
</div></div><p><strong>Procedures are objects*stored inside the database</strong> and once created, they’re always there for use.</p><div class="panel" style="border-width: 1px;"><div class="panelContent">
<p><strong>Procedures and functions in MySQL are called*stored routines</strong>, because they’re ment to ease often repeated actions.</p>
</div></div><ul><li>See TDB documentation on how to use procedures: <a href="http://docs.google.com/present/view?id=dc98z2zz_58dgdphpgd" class="external-link" rel="nofollow">Stored Procedures for Users</a></li></ul><ul><li>See TDB project documentation: <a href="http://docs.google.com/present/view?id=dc98z2zz_5pgwcbpdw" class="external-link" rel="nofollow">Stored Procedures</a></li></ul><ul><li>See more information at: <a href="http://dev.mysql.com/doc/refman/5.0/en/stored-routines-syntax.html" class="external-link" rel="nofollow">MySQL Reference Manual</a></li></ul><h1 id="MySQLStoredProcedures-MySQLStoresProceduresonTrinity">MySQL Stores Procedures on Trinity</h1><p>Since updatepack 27 we’re implementing stored MySQL procedures to be used for fix submissions.<br /> MySQL stored procedures are expected to be used in most of submited fixes on TDB forums once the project's fully established.</p><h2 id="MySQLStoredProcedures-Error-HandlingProcedure">Error-Handling Procedure</h2><p>Error handlers are used for data validation inside of other procedures.<br /> They consist of regular MySQL queries and logical operations such as IF or CASE.<br /> They validate data by either proving its existence in the database or making sure data is within proper ranges and types, etc. If this fails – the procedure raises an error, failing the procedure call.<br /> As a standard, these procedures have names starting with <strong><em>sp_tdb_Check</em></strong>*.</p><h3 id="MySQLStoredProcedures-`sp_CheckNpcEntry`">`sp_CheckNpcEntry`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT</p></td><td class="confluenceTd"><p>Entry of the npc to check</p></td></tr></tbody></table></div><p>Description: Error handling for TDB procedure: check if npc of provided ID exists in database</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_CheckNpcEntry`(257); -- will error out if invalid npc entry (creature_template.entry = 257)</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_CheckTriggerId`">`sp_CheckTriggerId`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>trigger_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID to check against the db for quest objective</p></td></tr></tbody></table></div><p>Description: Check if provided creature ID is requirement of any quest into database (quest_template)</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Quest_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">quest_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_CheckTriggerId`(257); -- make sure trigger (creature_template.entry = 257) is requirement for a quest</pre>
</div></div><p>.</p><h3 id="MySQLStoredProcedures-`sp_CheckQuestEntry`">`sp_CheckQuestEntry`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>quest_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Entry of quest from quest_template</p></td></tr></tbody></table></div><p>Description: Check if provided quest exists in database (quest_template)</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Quest_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">quest_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_CheckQuestEntry`(9876); -- check if quest with ID 9876 exists in database</pre>
</div></div><p>.</p><h3 id="MySQLStoredProcedures-`sp_CheckNPCOrGO`">`sp_CheckNPCOrGO`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_or_go_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Entry of creature or gameobject from *_template</p></td></tr><tr><td class="confluenceTd"><p>entry_type</p></td><td class="confluenceTd"><p>IN VARCHAR(10)</p></td><td class="confluenceTd"><p>must be 'GO' or 'NPC'</p></td></tr></tbody></table></div><p>Description: Check if npc or gameobject with provided entry exists in database (creature_template or gameobject_template)</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Gameobject_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">gameobject_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_CheckNPCOrGO`(257,&#39;NPC&#39;); -- check if NPC with entry = 257 exists in database</pre>
</div></div><p>.</p><h3 id="MySQLStoredProcedures-`sp_CheckGobjEntry`">`sp_CheckGobjEntry`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>gameobject_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Entry of the npc to check</p></td></tr></tbody></table></div><p>Description: Check if provided gameobject exists in database (table gameobject_template)</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Gameobject_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">gameobject_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_CheckGobjEntry`(175124); -- check if Rookery Egg exists in database, error if not</pre>
</div></div><p>.</p><h2 id="MySQLStoredProcedures-UtilityProcedure">Utility Procedure</h2><p>Utility procedures are typically only used within other, more complex procedures. They tend to help with small pieces of a larger solution. Using utility procedures is usually more complicated than just a basic procedure because there is often cleanup needed after using them (or other special circumstances requiring expert knowledge of the procedure). Use these with care.</p><h3 id="MySQLStoredProcedures-`sp_GetEntryList`">`sp_GetEntryList`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>input</p></td><td class="confluenceTd"><p>IN TEXT</p></td><td class="confluenceTd"><p>A comma-delimited list of entries to be split and inserted individually into a temporary table</p></td></tr></tbody></table></div><p>Description: Utility procedure to split a comma-delimited list into a temporary table to be used outside of the procedure. Drop up the temporary table after using it. USE WITH CARE.</p><p>Dependencies: none</p><p>Tables Affected: <a href="MySQLStoredProcedures_332657.html">tdb_entry_list</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_GetEntryList`(&#39;1,2,3,4,5,6&#39;); -- creates a temp table with 6 rows containing the values 1-6 respectively
SELECT * FROM `tdb_entry_list`; -- use this table as a source for other actions
DROP TEMPORARY TABLE `tdb_entry_list`; -- always drop the table when finished!</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_ReGuid`">`sp_ReGuid`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>new_base_guid</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>All creature guids will be re-numbered with the first guid being this number</p></td></tr></tbody></table></div><p>Description: Will re-number all existing guids in creature table starting with a provided value</p><p>Dependencies: `sp_ReGuidAlterTables`</p><p>Tables Affected: Any with creature.guid value in use</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_ReGuid`(1000); -- will renumber all existing guids in creature table starting with 1000 as initial</pre>
</div></div><h2 id="MySQLStoredProcedures-BasicProcedure">Basic Procedure</h2><p>Basic procedures are simple, concise, and only accommodate one piece of functionality. These differ from <a href="MySQLStoredProcedures_332657.html">Utility Procedures</a> in that they can be used by themselves safely and easily without knowledge of any other procedures (outside of <a href="MySQLStoredProcedures_332657.html">Error-Handling Procedures</a>). They do one thing, and only one thing.</p><h3 id="MySQLStoredProcedures-`sp_TriggerSettings`">`sp_TriggerSettings`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT</p></td><td class="confluenceTd"><p>Entry of the npc for whom template is updated</p></td></tr></tbody></table></div><p>Description: Sets NPC as a trigger (disable movements, ignore aggro, and disable targetting)</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_tdb_TriggerSettings`(257); -- sets npc having `creature_template`.`entry` = 257 to act as trigger</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SpellScriptTarget`">`sp_SpellScriptTarget`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>spell_ID</p></td><td class="confluenceTd"><p>IN INT</p></td><td class="confluenceTd"><p>ID of spell we want to set target for</p></td></tr><tr><td class="confluenceTd"><p>target_type</p></td><td class="confluenceTd"><p>IN VARCHAR(10)</p></td><td class="confluenceTd"><p>Choose from ('GO','NPC','DEAD_NPC','MINION')</p></td></tr><tr><td class="confluenceTd"><p>spell_target_entry</p></td><td class="confluenceTd"><p>IN INT(11)</p></td><td class="confluenceTd"><p>ID of creature or gameobject</p></td></tr></tbody></table></div><p>Description: Sets target requirement for spellcast</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Spell_script_target&amp;linkCreation=true&amp;fromPageId=332657">spell_script_target</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SpellScriptTarget`(4444,&#39;NPC&#39;,257); -- allows spell 4444 to be cast only on living creature with `creature_template`.`entry` = 257</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_KillQuestgiver`">`sp_KillQuestgiver`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry`</p></td></tr></tbody></table></div><p>Description: Update creature to appear death but still react to eAI / give or take quests</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_addon_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template_addon</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `TDB_sp_KillQuestgiver`(257); -- Makes creature with entry 257 appear dead but still albe to give / take quests or react to spellhits</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_MakeAttackable`">`sp_MakeAttackable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be made attackable</p></td></tr></tbody></table></div><p>Description: Update npc to be attackable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_MakeAttackable`(257); -- enables attacking for NPC with ID 257 (creature_template.entry)</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_IgnoreAggro`">`sp_IgnoreAggro`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be made to ignore aggro</p></td></tr></tbody></table></div><p>Description: Update npc to be ignore aggro</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_IgnoreAggro`(257); -- makes NPC with ID 257 ignore aggro</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_MakeLootable`">`sp_MakeLootable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be made lootable</p></td></tr></tbody></table></div><p>Description: Update npc to become lootable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_MakeLootable`(257); -- makes NPC with ID 257 lootable</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SetFaction`">`sp_SetFaction`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` whose faction is to be changed</p></td></tr><tr><td class="confluenceTd"><p>faction_A</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Alliance faction to set</p></td></tr><tr><td class="confluenceTd"><p>faction_H</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Horde faction to set</p></td></tr></tbody></table></div><p>Description: Update npc's faction for both alliance and horde</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;"> CALL `sp_SetFaction`(257,7,7); -- sets faction to 7 for NPC with ID 257 (Kobold Worker)</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SetSelectable`">`sp_SetSelectable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be made selectable</p></td></tr></tbody></table></div><p>Description: Update npc to become selectable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SetSelectable`(257); -- makes NPC with ID 257 selectable</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SetQuestlevel`">`sp_SetQuestlevel`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>quest_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of a quest from quest_template</p></td></tr><tr><td class="confluenceTd"><p>quest_level</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>New MinLevel value for the selected quest</p></td></tr></tbody></table></div><p>Description: Update quest to provided level. Only for seasonal quests where levels are not correct from WDB.</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckQuestEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Quest_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">quest_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;"> CALL `sp_SetQuestlevel`(11335,30) - sets MinLevel of quest ID 11335 (Call to Arms: Arathi Basin) to 30</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SetNotSelectable`">`sp_SetNotSelectable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be not selectable</p></td></tr></tbody></table></div><p>Description: Update npc to become not selectable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SetNotSelectable`(257); -- makes NPC with ID 257 not selectable</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_MakeNotLootable`">`sp_MakeNotLootable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should not be lootable</p></td></tr></tbody></table></div><p>Description: Update npc to become not lootable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_MakeNotLootable`(257); -- makes creature of ID 257 (Kobold Worker) not lootable</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_NotIgnoreAggro`">`sp_NotIgnoreAggro`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should aggro normally</p></td></tr></tbody></table></div><p>Description: Update npc to aggro normally</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_NotIgnoreAggro`(257); -- makes creature of ID 257 (Kobold Worker) stop ignoring aggro</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_MakeNotAttackable`">`sp_MakeNotAttackable`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` who should be unattackable</p></td></tr></tbody></table></div><p>Description: Update npc to become unattackable</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_MakeNotAttackable`(257); -- disables attacking of creature with ID 257 (creature_template.entry - Kobold Worker)</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_GetLootIdForChest`">`sp_GetLootIdForChest`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>go_id</p></td><td class="confluenceTd"><p>IN MEDIUMINT(6)</p></td><td class="confluenceTd"><p>ID of the gameobject whose loot id is to be gathered</p></td></tr><tr><td class="confluenceTd"><p>go_loot_id</p></td><td class="confluenceTd"><p>OUT INT(10)</p></td><td class="confluenceTd"><p>variable to store the retrieved value in</p></td></tr></tbody></table></div><p>Description: Get the loot ID for a specified gameobject (data1 field). Must be a chest (type=3).</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckGobjEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Gameobject_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">gameobject_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_GetLootIdForChest`(194200,@Test); -- get the loot id for g194200 (Rare Cache of Winter) and put it in a variable
SELECT * FROM `gameobject_loot_template` WHERE `entry`=@Test; -- use the variable containing the lootid for a fix</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_get_ref_id`">`sp_get_ref_id`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>ref_type</p></td><td class="confluenceTd"><p>IN VARCHAR(10)</p></td><td class="confluenceTd"><p>Must be one of the following: 'SKIN', 'ITEM', 'FISH', 'MILL', 'RAID_GOBJ', 'MINE', 'PROSPECT', 'WORLD', 'RAID_CRE', 'DUNGEON' or 'PICKPOCKET'</p></td></tr><tr><td class="confluenceTd"><p>reference</p></td><td class="confluenceTd"><p>OUT MEDIUMINT(5)</p></td><td class="confluenceTd"><p>variable to store the calculated reference id</p></td></tr></tbody></table></div><p>Description: Get a generated loot reference id based on the type of loot its to be used for</p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Loot_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">reference_loot_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_get_ref_id`(&#39;RAID_CRE&#39;,@Test); -- store the next available reference ID in the range for raid creatures in a variable
SELECT @Test; -- use the variable however we like in a fix</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_SetLootId`">`sp_SetLootId`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Entry of the npc whose lootid you would like to set</p></td></tr><tr><td class="confluenceTd"><p>loot_id</p></td><td class="confluenceTd"><p>IN MEDIUMINT(5)</p></td><td class="confluenceTd"><p>NULLABLE. If provided, set the specified NPC's lootid to this value. If NULL, NPC uses its own entry.</p></td></tr></tbody></table></div><p>Description: Sets the loot id of a specified NPC</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SetLootId`(10184,NULL); -- sets the lootid of c10184 (Onyxia) to its own entry number</pre>
</div></div><h2 id="MySQLStoredProcedures-AverageProcedure">Average Procedure</h2><p>Average level procedures are significantly more complex than <a href="MySQLStoredProcedures_332657.html">Basic Procedures</a>. They involve multiple tables, multiple procedure dependencies, and frequently perform more than one action. They do, however, still exist for often-used functionality. These types of procedures tend to mask complex behavior using only a few parameters.</p><h3 id="MySQLStoredProcedures-`sp_SetLootIdByList`">`sp_SetLootIdByList`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>entry_list</p></td><td class="confluenceTd"><p>IN TEXT</p></td><td class="confluenceTd"><p>Entry of the npc whose lootid you would like to set</p></td></tr><tr><td class="confluenceTd"><p>loot_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>NULLABLE. If provided, set the specified NPC's lootid to this value. If NULL, NPC uses its own entry.</p></td></tr></tbody></table></div><p>Description: Sets the loot id of a list of NPCs to either their own entry numbers or a specified value</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_GetEntryList</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a href="MySQLStoredProcedures_332657.html">tdb_entry_list</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SetLootIdByList` (&#39;1,2,3,4,5&#39;,&#39;99999&#39;); -- sets the loot id of 5 specified npcs to 99999</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_QuestRelations`">`sp_QuestRelations`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_or_go_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry` OR GameObject from `gameobject_template`</p></td></tr><tr><td class="confluenceTd"><p>switch_give_take</p></td><td class="confluenceTd"><p>IN VARCHAR(10)</p></td><td class="confluenceTd"><p>Must be either 'QGIVER', 'QTAKER', 'BOTH' - defines if NPC / GO will only give quest / take quest / do both</p></td></tr><tr><td class="confluenceTd"><p>quest_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Entry of quest from quest_template</p></td></tr><tr><td class="confluenceTd"><p>entry_type</p></td><td class="confluenceTd"><p>IN VARCHAR(10)</p></td><td class="confluenceTd"><p>Either 'NPC' or 'GO' based on the type of entry given</p></td></tr></tbody></table></div><p>Description: Sets the loot id of a list of NPCs to either their own entry numbers or a specified value</p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNPCOrGO</a>, <a href="MySQLStoredProcedures_332657.html">sp_CheckQuestEntry</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_questrelation_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_questionrelation</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_involvedrelation_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_involvedrelation</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Gameobject_questrelation_tc2&amp;linkCreation=true&amp;fromPageId=332657">gameobject_questionrelation</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Gameobject_involvedrelation_tc2&amp;linkCreation=true&amp;fromPageId=332657">gameobject_involvedrelation</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_SetLootIdByList`(&#39;1,2,3,4,5&#39;,&#39;99999&#39;); -- sets the loot id of 5 specified npcs to 99999</pre>
</div></div><h2 id="MySQLStoredProcedures-AdvancedProcedure">Advanced Procedure</h2><p>Advanced procedures are used rarely. They involved many tables, procedures, and have many dependencies and clean up measures required. They are to be used with great care as they will often take a significant amount of time to execute as well. Not for beginners, use any of these with care.</p><p><em>No procedures accepted.</em></p><h2 id="MySQLStoredProcedures-EventAIProcedures">Event AI Procedures</h2><p>These procedures are specific to ScriptDev2-based content, namely the Event AI tables. All eAI procedures relate to the same tables, which are described in the <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Event_AI&amp;linkCreation=true&amp;fromPageId=332657">Event AI Guide</a>.</p><h3 id="MySQLStoredProcedures-`sp_eai_selectID`">`sp_eai_selectID`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>creature_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>Creature entry to check against</p></td></tr><tr><td class="confluenceTd"><p>event_id</p></td><td class="confluenceTd"><p>OUT INT(10)</p></td><td class="confluenceTd"><p>Best EventAI ID to associate with the specified creature</p></td></tr></tbody></table></div><p>Description: Check if eAI exists and get best id for new entries. To be used inside other eAI procs only.</p><p>Degree: <a href="MySQLStoredProcedures_332657.html">Utility</a></p><p>Dependencies: none</p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_ai_scripts_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_ai_scripts</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_eai_selectID`(8956,@eventID); -- gets an appropriate eAI event id for c8956 (Angerclaw Bear) and places it in the @eventID variable</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_eai_KillCreditOnSpellhit`">`sp_eai_KillCreditOnSpellhit`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry`</p></td></tr><tr><td class="confluenceTd"><p>spell_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of spell we want to set target for</p></td></tr><tr><td class="confluenceTd"><p>trigger_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of trigger NPC that needs to be killed for quest objective</p></td></tr><tr><td class="confluenceTd"><p>despawn_time</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>time (milliseconds) before NPC despawns</p></td></tr></tbody></table></div><p>Description: Perform eAI script for NPC to give credit on spellhit</p><p>Degree: <a href="MySQLStoredProcedures_332657.html">Average</a></p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a>, <a href="MySQLStoredProcedures_332657.html">sp_CheckTriggerId</a>, <a href="MySQLStoredProcedures_332657.html">sp_eai_selectID</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_ai_scripts_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_ai_scripts</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">-- Creature of ID 257 when hit with spell of ID 4444 will give credit for killing NPC of ID 1235 and will then despawn after 10 seconds
CALL `sp_tdb_eai_KillCreditOnSpellhit`(257,4444,1235,10000); </pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_eai_CastSpellOnSpawn`">`sp_eai_CastSpellOnSpawn`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry`</p></td></tr><tr><td class="confluenceTd"><p>spell_id</p></td><td class="confluenceTd"><p>IN INT(6)</p></td><td class="confluenceTd"><p>ID of spell we want to set target for</p></td></tr></tbody></table></div><p>Description: Perform eAI script for NPC to cast spell on self upon spawn</p><p>Degree: <a href="MySQLStoredProcedures_332657.html">Average</a></p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a>, <a href="MySQLStoredProcedures_332657.html">sp_eai_selectID</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_ai_scripts_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_ai_scripts</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_eai_CastSpellOnSpawn`(257,4444); -- Creature of ID 257 (Kobold Worker) will cast spell of ID 4444 on self when spawned</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_eai_KillCreditOnDeath`">`sp_eai_KillCreditOnDeath`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry`</p></td></tr><tr><td class="confluenceTd"><p>trigger_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of trigger NPC that needs to be killed for quest objective</p></td></tr></tbody></table></div><p>Description: Create eAI script for NPC to give credit on death</p><p>Degree: <a href="MySQLStoredProcedures_332657.html">Average</a></p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a>, <a href="MySQLStoredProcedures_332657.html">sp_eai_selectID</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_ai_scripts_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_ai_scripts</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">CALL `sp_eai_KillCreditOnDeath`(46,257); -- NPC of ID 46 (Murloc Forager) when killed will give credit for killing NPC with ID 257 (Kobold Worker)</pre>
</div></div><h3 id="MySQLStoredProcedures-`sp_eAI_SpawnOnSpellhit`">`sp_eAI_SpawnOnSpellhit`</h3><p>Parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Name</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>npc_entry</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of NPC from `creature_template`.`entry`</p></td></tr><tr><td class="confluenceTd"><p>spell_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>ID of spell we want to set target for</p></td></tr><tr><td class="confluenceTd"><p>spawn_id</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>NPC that will be spawned at current location of the provided npc_entry</p></td></tr><tr><td class="confluenceTd"><p>despawn_time</p></td><td class="confluenceTd"><p>IN INT(10)</p></td><td class="confluenceTd"><p>time (milliseconds) before summoned NPC despawns</p></td></tr></tbody></table></div><p>Description: Create eAI script for NPC to give credit on death</p><p>Degree: <a href="MySQLStoredProcedures_332657.html">Average</a></p><p>Dependencies: <a href="MySQLStoredProcedures_332657.html">sp_CheckNpcEntry</a>, <a href="MySQLStoredProcedures_332657.html">sp_eai_selectID</a></p><p>Tables Affected: <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_template_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_template</a>, <a class="createlink" href="/pages/createpage.action?spaceKey=tc&amp;title=Creature_ai_scripts_tc2&amp;linkCreation=true&amp;fromPageId=332657">creature_ai_scripts</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">-- NPC of id 1234 will summon NPC of id 1235 upon being cast spell 4444. NPC 1235 will despawn after 100s
CALL `sp_eAI_SpawnOnSpellhit`(1234,4444,1235,100000);</pre>
</div></div><h1 id="MySQLStoredProcedures-TemporaryTables">Temporary Tables</h1><p>Temporary tables are a way to store complex data that needs to be used in more than one place but should not be stored permanently. For TDB procedures, we will use them to pass data from one procedure call to another. This method is clean but often requires knowledge of the temporary table(s) being used and how to clean them up properly. Remember: if you use a procedure that uses a temporary table, make sure you drop that table afterwards.</p><h2 id="MySQLStoredProcedures-`tdb_entry_list`">`tdb_entry_list`</h2><p><strong>Structure</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>Field</strong></p></td><td class="confluenceTd"><p><strong>Type</strong></p></td><td class="confluenceTd"><p><strong>Attributes</strong></p></td><td class="confluenceTd"><p><strong>Key</strong></p></td><td class="confluenceTd"><p><strong>Null</strong></p></td><td class="confluenceTd"><p><strong>Default</strong></p></td><td class="confluenceTd"><p><strong>Extra</strong></p></td><td class="confluenceTd"><p><strong>Comment</strong></p></td></tr><tr><td class="confluenceTd"><p><a href="MySQLStoredProcedures_332657.html">entry</a></p></td><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>unsigned</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>NO</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>any entry</p></td></tr></tbody></table></div><p><strong>Description of the fields</strong></p><h3 id="MySQLStoredProcedures-entry">entry</h3><p>Any entry, used by multiple tables</p><h1 id="MySQLStoredProcedures-Examples">Examples</h1><p>Here are some raw views at what the stored procedures actually look like. We hope you can use these to better understand what, exactly, a stored procure is (and maybe, use these as inspiration to write your own!). Please refer to the PDF manuals at the <a href="MySQLStoredProcedures_332657.html">top of this page</a> for more information on stored procedures and how they are used here at TDB.</p><h2 id="MySQLStoredProcedures-sp_CheckNpcEntry">sp_CheckNpcEntry</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">DELIMITER //
CREATE PROCEDURE `sp_CheckNpcEntry` (IN creature_entry INT)
BEGIN
/**
 * DEGREE: UTILITY
 * TABLES AFFECTED: creature_template
 * PROCS USED: none
 *
 * Error handling for TDB procedure: check if creature of provided ID exists in database
 *
 * creature_entry - Entry of the npc to check
 *
 * CALL `sp_CheckNpcEntry` (257); -- will error out if invalid npc entry (creature_template.entry = 257)
 */
    DECLARE Check_entry INT;
    SET Check_entry = (SELECT COUNT(entry) FROM `creature_template` WHERE `entry`= creature_entry);

    IF Check_entry = 0 THEN 
        CALL INVALID_CREATURE_ENTRY();
    ELSE 
        SET Check_entry = 0;
    END IF;
END//

DELIMITER ;</pre>
</div></div><h2 id="MySQLStoredProcedures-sp_CheckNPCOrGO">sp_CheckNPCOrGO</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">DELIMITER //
CREATE PROCEDURE `sp_CheckNPCOrGO`(IN npc_or_go_entry INT(10), IN entry_type VARCHAR(10)) 
BEGIN
/**
 * DEGREE: ERROR HANDLER
 * TABLES AFFECTED: creature_template, gameobject_template
 * PROCS USED: none
 * 
 * npc_or_go_entry - entry of creature or gameobject from *_template
 * entry_type: [&quot;GO&quot;|&quot;NPC&quot;]
 *
 * ex: CALL `sp_CheckNPCOrGO` (257, &quot;NPC&quot;); -- check if NPC with entry = 257 exists in database
 */
DECLARE Check_entry INT;
CASE entry_type
        WHEN &quot;NPC&quot; THEN
SET Check_entry = (SELECT COUNT(`entry`) FROM `creature_template` WHERE `entry`=npc_or_go_entry);
        WHEN &quot;GO&quot; THEN
SET Check_entry = (SELECT COUNT(`entry`) FROM `gameobject_template` WHERE `entry`=npc_or_go_entry);
        ELSE
        CALL INCORRECT_ENTRY_TYPE();
END CASE;
IF Check_entry=0 THEN
CALL INCORRECT_CREATURE_OR_GO_ID();
END IF;
END //

DELIMITER ;</pre>
</div></div><h2 id="MySQLStoredProcedures-sp_MakeNotLootable">sp_MakeNotLootable</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">DELIMITER //
CREATE PROCEDURE `sp_MakeNotLootable`(IN npc_entry INT(10))
BEGIN
/**
 * DEGREE: BASIC
 * TABLES AFFECTED: creature_template
 * PROCS USED: sp_CheckNpcEntry
 *
 * Update creature to become not lootable
 *
 * creature_entry - ID of NPC from `creature_template`.`entry`
 * 
 * ex: CALL `sp_MakeNotLootable` (257); -- makes creature of ID 257 (Kobold Worker) not lootable
 */
    CALL `sp_CheckNpcEntry` (npc_entry);
    UPDATE `creature_template` SET `dynamicflags`=`dynamicflags`&amp;~1 WHERE `entry`= npc_entry;
END //

DELIMITER ;</pre>
</div></div><h2 id="MySQLStoredProcedures-sp_SetLootIdByList">sp_SetLootIdByList</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: RDark; brush: cpp; gutter: false" style="font-size:12px;">DELIMITER //
CREATE PROCEDURE `sp_SetLootIdByList` (IN entryList TEXT,IN lootID MEDIUMINT(5))
BEGIN    
/**
 * DEGREE: AVERAGE
 * TABLES AFFECTED: creature_template, tdb_entry_list (temp)
 * PROCS USED: sp_GetEntryList
 *
 * Sets the loot id of a specified NPC
 *
 * npcEntry - Entry of the npc whose lootid you would like to set
 * loot - NULLABLE. If provided, set the specified NPC&#39;s lootid to this value. If NULL, NPC uses its own entry.
 * 
 * ex: CALL `sp_SetLootIdByList` (&#39;1,2,3,4,5&#39;,&#39;99999&#39;); -- sets the loot id of 5 specified npcs to 99999
 */
    CALL `sp_GetEntryList` (entryList);
    UPDATE `creature_template` SET `lootid`=IFNULL(lootID,`entry`) WHERE `entry` IN (SELECT DISTINCT * FROM `tdb_entry_list`);
    
    DROP TEMPORARY TABLE `tdb_entry_list`; -- dont forget the cleanup!
END//

DELIMITER ;</pre>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 07, 2014 22:00</p>
                </section>
            </div>
        </div>     </body>
</html>
